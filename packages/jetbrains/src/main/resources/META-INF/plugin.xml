<idea-plugin>
    <id>dev.sentinelseed.jetbrains</id>
    <name>Sentinel AI Safety</name>
    <vendor email="team@sentinelseed.dev" url="https://sentinelseed.dev">Sentinel Seed Team</vendor>

    <description><![CDATA[
        <h2>AI Safety Guardrails for LLM Prompts</h2>

        <p>Sentinel AI Safety provides real-time safety analysis for LLM prompts and AI-generated content
        using the <strong>THSP protocol</strong> (Truth, Harm, Scope, Purpose).</p>

        <h3>Features</h3>
        <ul>
            <li><strong>Real-time Analysis</strong> - Analyze code and prompts for safety issues</li>
            <li><strong>THSP Protocol</strong> - Four-gate validation system:
                <ul>
                    <li>Truth Gate: Detects deception and misinformation</li>
                    <li>Harm Gate: Identifies potential harm</li>
                    <li>Scope Gate: Checks boundary violations</li>
                    <li>Purpose Gate: Validates legitimate purpose</li>
                </ul>
            </li>
            <li><strong>Security Scanning</strong> - Detect secrets, SQL injection, and prompt injection</li>
            <li><strong>Output Validation</strong> - Validate LLM outputs for security issues</li>
            <li><strong>Compliance Checking</strong> - EU AI Act, OWASP LLM Top 10, CSA AICM</li>
            <li><strong>Metrics Dashboard</strong> - Track analysis statistics over time</li>
            <li><strong>Semantic Analysis</strong> - Optional LLM-powered deep analysis (OpenAI/Anthropic)</li>
            <li><strong>Seed Insertion</strong> - Insert alignment seeds into your prompts</li>
            <li><strong>Tool Window</strong> - Dedicated panel for analysis results</li>
        </ul>

        <h3>Usage</h3>
        <ol>
            <li>Select text or right-click in editor</li>
            <li>Choose "Sentinel: Analyze Selection" from context menu</li>
            <li>View results in the Sentinel tool window</li>
        </ol>

        <h3>Configuration</h3>
        <p>Configure API keys for semantic analysis in Settings → Tools → Sentinel AI Safety</p>

        <p><a href="https://sentinelseed.dev/docs">Documentation</a> |
        <a href="https://github.com/sentinel-seed/sentinel">GitHub</a></p>
    ]]></description>

    <change-notes><![CDATA[
        <h3>0.3.0</h3>
        <ul>
            <li>Add Security Scanning: Scan Secrets, Sanitize Prompt, Validate Output, SQL Injection Detection</li>
            <li>Add Compliance Checking: EU AI Act, OWASP LLM Top 10, CSA AI Controls Matrix</li>
            <li>New SecurityService for local security pattern matching</li>
            <li>New ComplianceService with EU AI Act Article 5/6/52 detection</li>
            <li>OWASP LLM Top 10 pattern detection (LLM01, LLM02, LLM05, LLM06, LLM07)</li>
            <li>Database Guard: SQL injection detection across 8 categories</li>
            <li>Add Metrics Dashboard: Track analysis statistics over time</li>
            <li>New MetricsService with persistent storage</li>
            <li>10 new commands in Sentinel menu (4 security + 4 compliance + 2 metrics)</li>
        </ul>

        <h3>0.2.1</h3>
        <ul>
            <li>Fix deprecated CredentialAttributes constructor (use named parameters)</li>
            <li>Full compatibility with IntelliJ 2024.x and 2025.x</li>
        </ul>

        <h3>0.2.0</h3>
        <ul>
            <li>Add Ollama support for local, free semantic analysis</li>
            <li>Add OpenAI-compatible endpoints (Groq, Together AI)</li>
            <li>Four LLM providers now available: OpenAI, Anthropic, Ollama, Custom</li>
            <li>Updated settings UI with provider-specific configuration</li>
        </ul>

        <h3>0.1.2</h3>
        <ul>
            <li>Use non-deprecated CredentialAttributes constructor with userName parameter</li>
            <li>Full compatibility with IntelliJ 2024.x and 2025.x</li>
        </ul>

        <h3>0.1.1</h3>
        <ul>
            <li>Fix deprecated CredentialAttributes API usage</li>
            <li>Improved compatibility with IntelliJ 2025.x</li>
        </ul>

        <h3>0.1.0</h3>
        <ul>
            <li>Initial release</li>
            <li>THSP protocol validation</li>
            <li>Semantic analysis with OpenAI/Anthropic</li>
            <li>Heuristic fallback mode</li>
            <li>Seed insertion commands</li>
            <li>Dedicated tool window</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Application Service for validation logic -->
        <applicationService
            serviceImplementation="dev.sentinelseed.jetbrains.services.SentinelService"/>

        <!-- Security Service for scanning -->
        <applicationService
            serviceImplementation="dev.sentinelseed.jetbrains.services.SecurityService"/>

        <!-- Compliance Service for framework checks -->
        <applicationService
            serviceImplementation="dev.sentinelseed.jetbrains.services.ComplianceService"/>

        <!-- Metrics Service for tracking analyses -->
        <applicationService
            serviceImplementation="dev.sentinelseed.jetbrains.services.MetricsService"/>

        <!-- Project-level settings state -->
        <projectService
            serviceImplementation="dev.sentinelseed.jetbrains.settings.SentinelProjectSettings"/>

        <!-- Application-level settings state -->
        <applicationService
            serviceImplementation="dev.sentinelseed.jetbrains.settings.SentinelApplicationSettings"/>

        <!-- Settings configurable in Preferences -->
        <applicationConfigurable
            id="sentinel.settings"
            displayName="Sentinel AI Safety"
            groupId="tools"
            instance="dev.sentinelseed.jetbrains.settings.SentinelSettingsConfigurable"/>

        <!-- Tool window for results -->
        <toolWindow
            id="Sentinel"
            anchor="bottom"
            icon="/icons/sentinel-13.svg"
            factoryClass="dev.sentinelseed.jetbrains.ui.SentinelToolWindowFactory"/>

        <!-- Status bar widget -->
        <statusBarWidgetFactory
            id="SentinelStatusWidget"
            implementation="dev.sentinelseed.jetbrains.ui.SentinelStatusWidgetFactory"/>

        <!-- Code inspections for real-time analysis -->
        <localInspection
            groupName="Sentinel AI Safety"
            shortName="SentinelSafetyInspection"
            displayName="THSP Safety Analysis"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="dev.sentinelseed.jetbrains.inspections.SentinelInspection"/>

        <!-- Notification group -->
        <notificationGroup
            id="Sentinel Notifications"
            displayType="BALLOON"/>
    </extensions>

    <actions>
        <!-- Main action group -->
        <group id="Sentinel.ActionGroup"
               text="Sentinel"
               popup="true"
               icon="/icons/sentinel-13.svg">

            <action id="Sentinel.AnalyzeSelection"
                    class="dev.sentinelseed.jetbrains.actions.AnalyzeSelectionAction"
                    text="Analyze Selection"
                    description="Analyze selected text for safety issues"
                    icon="AllIcons.Actions.Checked">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt S"/>
            </action>

            <action id="Sentinel.AnalyzeFile"
                    class="dev.sentinelseed.jetbrains.actions.AnalyzeFileAction"
                    text="Analyze File"
                    description="Analyze entire file for safety issues"
                    icon="AllIcons.Actions.CheckMultiple">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt F"/>
            </action>

            <separator/>

            <action id="Sentinel.InsertSeedStandard"
                    class="dev.sentinelseed.jetbrains.actions.InsertSeedAction"
                    text="Insert Standard Seed"
                    description="Insert the standard Sentinel alignment seed"
                    icon="AllIcons.Actions.AddFile"/>

            <action id="Sentinel.InsertSeedMinimal"
                    class="dev.sentinelseed.jetbrains.actions.InsertMinimalSeedAction"
                    text="Insert Minimal Seed"
                    description="Insert the minimal Sentinel alignment seed"
                    icon="AllIcons.Actions.AddFile"/>

            <separator/>

            <action id="Sentinel.ShowStatus"
                    class="dev.sentinelseed.jetbrains.actions.ShowStatusAction"
                    text="Show Status"
                    description="Show Sentinel analysis status"
                    icon="AllIcons.General.Information"/>

            <action id="Sentinel.OpenSettings"
                    class="dev.sentinelseed.jetbrains.actions.OpenSettingsAction"
                    text="Settings..."
                    description="Open Sentinel settings"
                    icon="AllIcons.General.Settings"/>

            <separator/>

            <!-- Security Scanning Actions -->
            <action id="Sentinel.ScanSecrets"
                    class="dev.sentinelseed.jetbrains.actions.ScanSecretsAction"
                    text="Scan Secrets"
                    description="Scan for API keys, tokens, and credentials"
                    icon="AllIcons.Ide.HectorOff"/>

            <action id="Sentinel.SanitizePrompt"
                    class="dev.sentinelseed.jetbrains.actions.SanitizePromptAction"
                    text="Sanitize Prompt"
                    description="Detect prompt injection attempts"
                    icon="AllIcons.Actions.Lightning"/>

            <action id="Sentinel.ValidateOutput"
                    class="dev.sentinelseed.jetbrains.actions.ValidateOutputAction"
                    text="Validate Output"
                    description="Validate LLM output for security issues"
                    icon="AllIcons.Actions.PreviewDetails"/>

            <action id="Sentinel.ScanSQLInjection"
                    class="dev.sentinelseed.jetbrains.actions.ScanSQLInjectionAction"
                    text="SQL Injection Scan"
                    description="Detect SQL injection patterns"
                    icon="AllIcons.Providers.Postgresql"/>

            <separator/>

            <!-- Compliance Checking Actions -->
            <action id="Sentinel.CheckComplianceAll"
                    class="dev.sentinelseed.jetbrains.actions.CheckComplianceAllAction"
                    text="Check All Compliance"
                    description="Check against all compliance frameworks"
                    icon="AllIcons.Actions.ListFiles"/>

            <action id="Sentinel.CheckEUAIAct"
                    class="dev.sentinelseed.jetbrains.actions.CheckEUAIActAction"
                    text="Check EU AI Act"
                    description="Check against EU AI Act requirements"
                    icon="AllIcons.Nodes.SecurityRole"/>

            <action id="Sentinel.CheckOWASP"
                    class="dev.sentinelseed.jetbrains.actions.CheckOWASPAction"
                    text="Check OWASP LLM"
                    description="Check against OWASP LLM Top 10"
                    icon="AllIcons.General.Shield"/>

            <action id="Sentinel.CheckCSA"
                    class="dev.sentinelseed.jetbrains.actions.CheckCSAAction"
                    text="Check CSA AICM"
                    description="Check against CSA AI Controls Matrix"
                    icon="AllIcons.Nodes.Artifact"/>

            <separator/>

            <!-- Metrics Dashboard Actions -->
            <action id="Sentinel.ShowMetrics"
                    class="dev.sentinelseed.jetbrains.actions.ShowMetricsAction"
                    text="Show Metrics Dashboard"
                    description="Display analysis statistics and metrics"
                    icon="AllIcons.Toolwindows.ToolWindowAnalyzeDataflow"/>

            <action id="Sentinel.ClearMetrics"
                    class="dev.sentinelseed.jetbrains.actions.ClearMetricsAction"
                    text="Clear Metrics"
                    description="Clear all stored analysis metrics"
                    icon="AllIcons.Actions.GC"/>

            <!-- Add to editor popup menu -->
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Add to Tools menu -->
        <group id="Sentinel.ToolsMenu">
            <reference ref="Sentinel.ActionGroup"/>
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </group>
    </actions>
</idea-plugin>
